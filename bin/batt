#!/usr/bin/env bash

# FIXME:
# * Report charging status
# * Detect colour support?
# TODO:
# * Handle missing .bash_colours file
[ -r "${HOME}/.bash_colours" ] && . "${HOME}/.bash_colours"

format () {
  local face=''
  if [ "$1" -le 20 ]; then
    face="${BASH_COLOURS[red_bf]}"
  elif [ "$1" -ge 80 ]; then
    face="${BASH_COLOURS[grn_bf]}"
  fi
  printf '%b%3u%b' "${face}" "$1" "${BLC_COLOURS[reset]}"
}

for bat in /sys/class/power_supply/BAT*; do
  printf '%s: %s%%\n' "$(basename ${bat})" "$(format $(cat ${bat}/capacity))"
done
unset bat
